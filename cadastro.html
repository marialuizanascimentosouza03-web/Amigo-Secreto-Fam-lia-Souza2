<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Amigo Secreto ‚Äî Cadastrar Participante</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <main class="container">
    <h1>Cadastrar participante</h1>
    <p>Preencha o nome, seus desejos e a senha que ser√° escrita no papel.</p>

    <form id="cad-form" class="card">
      <label>Nome completo:
        <input id="name" required />
      </label>

      <div id="items-area"></div>

      <div class="row">
        <button type="button" id="add-item">Adicionar item</button>
        <button type="button" id="reset-items">Resetar itens</button>
      </div>

      <label>Senha do papel:
        <input id="paper-pass" type="password" required />
      </label>

      <div class="row">
        <button type="submit">Salvar üéÅ</button>
      </div>

      <div id="cad-msg" class="msg"></div>
    </form>

    <footer class="muted">
      <a href="index.html">Voltar</a> ¬∑
      <a href="admin.html">Painel do organizador</a>
    </footer>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
    import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBcHaVgHaxwDkrNv6xVf0-b0RGdlslGjog",
      authDomain: "amigo-secreto-familia-souza30.firebaseapp.com",
      projectId: "amigo-secreto-familia-souza30",
      storageBucket: "amigo-secreto-familia-souza30.firebasestorage.app",
      messagingSenderId: "825640803161",
      appId: "1:825640803161:web:dacbdeb6a76f07fe6f8a48"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const itemsArea = document.getElementById("items-area");
    const addBtn = document.getElementById("add-item");
    const resetBtn = document.getElementById("reset-items");
    const cadMsg = document.getElementById("cad-msg");

    function addItem(title = "", link = "", note = "") {
      const div = document.createElement("div");
      div.className = "item-row";
      div.innerHTML = `
        <label>T√≠tulo: <input class="it-title" placeholder="Ex: Camiseta azul" value="${title}" /></label>
        <label>Link: <input class="it-link" placeholder="URL (opcional)" value="${link}" /></label>
        <label>Observa√ß√£o: <input class="it-note" placeholder="Opcional" value="${note}" /></label>
        <button type="button" class="remove-item">Remover</button>
      `;
      div.querySelector(".remove-item").addEventListener("click", () => div.remove());
      itemsArea.appendChild(div);
    }

    addItem();

    addBtn.addEventListener("click", () => addItem());
    resetBtn.addEventListener("click", () => { itemsArea.innerHTML = ""; addItem(); });

    document.getElementById("cad-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const nome = document.getElementById("name").value.trim();
      const senha = document.getElementById("paper-pass").value.trim();

      const itens = [];
      document.querySelectorAll(".item-row").forEach((r) => {
        const titulo = r.querySelector(".it-title").value.trim();
        const link = r.querySelector(".it-link").value.trim();
        const obs = r.querySelector(".it-note").value.trim();
        if (titulo) itens.push({ titulo, link, obs });
      });

      if (!nome || !senha || itens.length === 0) {
        cadMsg.textContent = "Preencha todos os campos obrigat√≥rios.";
        return;
      }

      try {
        await setDoc(doc(db, "listas", nome), { senha, itens });
        cadMsg.textContent = "üéâ Lista salva com sucesso!";
        e.target.reset();
        itemsArea.innerHTML = ""; addItem();
      } catch (err) {
        console.error(err);
        cadMsg.textContent = "Erro ao salvar: " + err.message;
      }
    });
  </script>
</body>
</html>
