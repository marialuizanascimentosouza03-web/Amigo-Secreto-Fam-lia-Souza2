<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Amigo Secreto â€” Ver Presente</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <main class="container">
    <h1>Amigo Secreto Da FamÃ­lia Souza ğŸ«¶ğŸ„</h1>
    <p>Digite o nome da pessoa que vocÃª tirou e a senha do papel.</p>

    <form id="view-form" class="card">
      <label>Nome da pessoa (exato):
        <input id="target-name" required autocomplete="off" />
      </label>
      <label>Senha do papel:
        <input id="paper-password" type="password" required autocomplete="off" />
      </label>
      <button type="submit">Ver presentes ğŸ</button>
      <div id="view-msg" class="msg"></div>
    </form>

    <section id="results" class="card hidden">
      <h2>Presentes de <span id="owner-name"></span></h2>
      <ol id="wishlist"></ol>
      <p id="notes"></p>
      <button id="back-btn">Voltar</button>
    </section>

    <footer class="muted">
      <a href="cadastro.html">Cadastrar participante</a> Â·
      <a href="admin.html">Painel do organizador</a>
    </footer>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBcHaVgHaxwDkrNv6xVf0-b0RGdlslGjog",
      authDomain: "amigo-secreto-familia-souza30.firebaseapp.com",
      projectId: "amigo-secreto-familia-souza30",
      storageBucket: "amigo-secreto-familia-souza30.firebasestorage.app",
      messagingSenderId: "825640803161",
      appId: "1:825640803161:web:dacbdeb6a76f07fe6f8a48"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    document.getElementById("view-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const nome = document.getElementById("target-name").value.trim();
      const senha = document.getElementById("paper-password").value.trim();
      const msg = document.getElementById("view-msg");

      msg.textContent = "Carregando...";

      try {
        const docRef = doc(db, "listas", nome);
        const docSnap = await getDoc(docRef);

        if (!docSnap.exists()) {
          msg.textContent = "Nome nÃ£o encontrado.";
          return;
        }

        const dados = docSnap.data();
        if (dados.senha !== senha) {
          msg.textContent = "Senha incorreta.";
          return;
        }

        // exibe lista
        document.getElementById("owner-name").textContent = nome;
        const lista = document.getElementById("wishlist");
        lista.innerHTML = "";

        dados.itens.forEach((item) => {
          const li = document.createElement("li");
          li.innerHTML = `
            <strong>${item.titulo}</strong>
            ${item.link ? `â€” <a href="${item.link}" target="_blank">link</a>` : ""}
            ${item.obs ? `<div class="small muted">${item.obs}</div>` : ""}
          `;
          lista.appendChild(li);
        });

        msg.textContent = "";
        document.getElementById("view-form").classList.add("hidden");
        document.getElementById("results").classList.remove("hidden");
      } catch (err) {
        msg.textContent = "Erro ao carregar dados.";
        console.error(err);
      }
    });

    document.getElementById("back-btn").addEventListener("click", () => {
      document.getElementById("results").classList.add("hidden");
      document.getElementById("view-form").classList.remove("hidden");
      document.getElementById("view-form").reset();
    });
  </script>
</body>
</html>
